{% extends "base.html" %}

{% block content %}
    <legend class="border-bottom mb-4">Request access : {{ user_name }}</legend>
    <table width="100%" class="table table-hover table-responsive table-bordered" style="table-layout:fixed;border-style : hidden!important; margin: 0px auto;">
        <form action="/access_resource_user" method="post" enctype = "multipart/form-data">
            <div class="form-group">
                <tr> 
                    <div class="input-group mb-4 input-group-md">
                    <td>
                        <div class="input-group-prepend">
                            <span class="input-group-text" style="width: 200px;">Choose Resource</span>
                        </div>
                    </td>
                    <td>
                        <SELECT name = "resource_id" style="width: 200; height: 37">
                        {% for resource in resources %}   
                            {%if selected_resource is defined and resource.resource_id | int == selected_resource | int %}   
                            <OPTION value = "{{ resource.resource_id }}" selected> {{ resource.resource_name }} </OPTION>
                            {% else %} 
                            <OPTION value = "{{ resource.resource_id }}"> {{ resource.resource_name }} </OPTION>
                            {% endif %}
                        {% endfor %}
                        </SELECT>
                    </td> 
                    </div>
                </tr>
            {% if sent_otp is not defined or sent_otp == False %}
                <tr> <td> Click for OTP verification </td> <td style="text-align: center;"> <input type = "submit" name = "send_otp" value = "Get OTP" style="width: 200; height: 37" /> </td> 
                </tr>
            {% else %}
                <tr>
                    <td> Enter OTP sent to your registered email 
                    </td> <td style="text-align: center;"> <input type = "password" name = "otp" style="width: 200; height: 37" /> </td> 
                </tr>
            {% endif %}
                <tr> <td style="text-align: center;" colspan="2"> <input type = "submit" name = "submit" style="width: 200; height: 37" /> </td> 
                </tr>
            </div>
        </form>
        {% if user_aval is defined %}
            <tr> 
                <td colspan="2" style="border: 5px solid black; white-space:pre-wrap"><u>User &lt;attribute:value&gt; pairs: </u><br><b>{{ user_aval }}</b>
                </td>
            </tr>
        {% endif %}
        <tr> 
            {% if message is defined %}
                {% if message.find('not allowed') != -1 %}    <!-- You are not allowed to access this object -->
                    <td colspan="2" style="border: 5px solid red;"> {{ message }} </td>
                {% else %}
                    <td colspan="2" style="border: 5px solid green;"> {{ message }} </td>
                {% endif %}
            {% endif %}
        </tr>
        <tr> 
            {% if execution_time is defined %}
                <td colspan="2" style="border: 5px solid grey;">Execution time : <b>{{ execution_time }}</b> ms</td>
            {% endif %}
        </tr>
    </table>

{% endblock %}